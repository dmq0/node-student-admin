<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¬¢è¿ç™»å½•</title>
  <link rel="stylesheet" href="./css/login.css">
  <link rel="stylesheet" href="./fonts/iconfont.css">
  <!-- æ³¨æ„æœ¬é¡¹ç›®åœ¨ä½¿ç”¨æ—¶ï¼Œæ›´æ”¹äº†bootstrapçš„cssæ–‡ä»¶ä¸­çš„æ ·å¼ -->
  <link rel="stylesheet" href="./css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/message.min.css">
  <script src="./js/bootstrap.bundle.min.js"></script>
  <script src="./js/jquery-3.5.1.min.js"></script>
  <script src="./js/message.min.js"></script>
  <script src="./utils/utils.js"></script>
</head>
<body>
  <div class="loginForm">
    <h2>ç”¨æˆ·ç™»å½•ğŸ˜</h2>
    <form>
        <div class="form-group">
            <label for="userInput">ç”¨æˆ·å</label>
            <input type="text" class="form-control" value="admin" id="userInput" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
            <p class="text-danger yc" id="userError">ç”¨æˆ·åé”™è¯¯</p>
        </div>
        <div class="form-group">
            <label for="passwordInput">å¯†ç </label>
            <input type="password" value="Admin123" class="form-control" id="passwordInput" placeholder="è¯·è¾“å…¥å¯†ç ">
            <i class="iconfont icon-yanjing1" id="passwordIcon"></i>
            <p class="text-danger yc" id="passwordError">å¯†ç é”™è¯¯</p>
        </div>
        <div class="button">
            <input type="button" class="btn btn-primary" id="dl" value="ç™» å½•"/>
        </div>
        
    </form>
    <br><br><br>å¤‡æ³¨ï¼š<br>
    <p>ç®¡ç†å‘˜ï¼šadmin ï¼Œå¯†ç ï¼šAdmin123<br>
         å­¦ç”Ÿ1ï¼šxd ï¼Œ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; å¯†ç ï¼šXd123123<br>
          å­¦ç”Ÿï¼šxc ï¼Œ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¯†ç ï¼šXc123123<br>
     </p>
</div>

</body>
<script>
    <!-- è§£æ”¾$ç¬¦å· -->
let J = jQuery.noConflict();
    J(function () {
       let userExg = /^(?!\d+$)\w{1,10}$/
       let passwordExg = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d!@#$%^&*]{8,20}$/
       // ç»‘å®šç‚¹å‡»äº‹ä»¶
       J('#dl').on('click',function () {
        if(passwordExg.test(J('#passwordInput').val()) && userExg.test(J('#userInput').val())){
        postLogin();
        }else{
        J('#dl').off('click',postLogin)
        Qmsg.error('ç™»å½•ä¿¡æ¯æœ‰è¯¯')
        }
     })
       // æ–‡æœ¬æ¡†æ”¹å˜æ—¶ï¼Œè¿›è¡Œæ ¡éªŒ
    J('#userInput').on('blur',function () {
        $('#userError').attr('class',userExg.test($('#userInput').val())?'text-danger yc':'text-danger xs')
    })
    J('#passwordInput').on('blur',function () {
        J('#passwordError').attr('class',passwordExg.test(J('#passwordInput').val())?'text-danger yc':'text-danger xs')
    })
    // ç‚¹å‡»åˆ‡æ¢æ ‡ç­¾æ ·å¼ï¼Œæ˜¾ç¤ºå¯†ç 
    let flag = false
    J('#passwordIcon').on('click',function () {
        J('#passwordInput').attr("type", flag?"password":"text");
        flag=!flag;
        J('#passwordIcon').attr('class',flag?'iconfont icon-yanjing':'iconfont icon-yanjing1');
    })

   
  // å®šä¹‰å‘é€ç™»å½•è¯·æ±‚çš„æ–¹æ³•
  const postLogin = function () {
        // ä¸€ã€å¼¹çª—æç¤º
       let loading=Qmsg.loading('ç™»å½•è¯·æ±‚ä¸­...')
        // äºŒã€åƒåç«¯å‘é€è¯·æ±‚
        request.post('/user/userLogin',{
            input:J('#userInput').val(),
            password:J('#passwordInput').val()
        })
        // ä¸‰ã€æ¥å—è¯·æ±‚è¿›è¡Œç™»å½•
        // å››ã€åœæ­¢åŠ è½½å¼¹çª—
        .then(function (res) {
            if(res.status=='success'){
                console.log('è¿™æ˜¯è¯·iå»çš„ä¿¡æ¯',res);
                console.log(res.data);
                console.log(res.userInfo);
                Qmsg.success('ç™»é™†æˆåŠŸ')
                // ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°æœ¬åœ° (è½¬ä¸ºjsonå­—ç¬¦ä¸²)
                localStorage.setItem('user',JSON.stringify(res.userInfo))
                localStorage.setItem('img',baseURL+'/userPhoto/'+res.userInfo[0].img)
                // è·³è½¬
                sessionStorage.setItem('token',res.data)
                location.replace('/pages/index.html')
            }else{
                Qmsg.error('è´¦å·æˆ–å¯†ç é”™è¯¯')
            }
        }).catch(err=>{
            Qmsg.error('æœåŠ¡å™¨é”™è¯¯')
        }).finally(()=>{
            loading.close()
        })
    }
  
    })
    
</script>
</html>